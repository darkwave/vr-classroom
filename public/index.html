<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, World! - A-Frame</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="./js/aframe.min.js"></script>
    <script src="./js/aframe-stl-model-component.min.js"></script>
    <script src="./js/aframe-drag-and-drop-component.min.js"></script>
    <script src="./js/aframe-crawling-cursor.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <a-scene drag-and-drop>
      <a-camera raycaster crawling-cursor="target: #my-cursor"></a-camera>
      <a-entity id="my-cursor"></a-entity>
      <a-entity environment="preset: default;"></e-entity>
    </a-scene>
  </body>
  <script type="text/javascript">
  var scene = document.querySelector('a-scene');
  var cursor3D = document.querySelector('#my-cursor');
  var currentScale = 0.01;


  var reader  = new FileReader();
  reader.addEventListener("load", function () {
    cursor3D.setAttribute('stl-model', {src:reader.result});
    cursor3D.setAttribute('scale', {x:currentScale, y:currentScale, z:currentScale});

  }, false);


    scene.addEventListener("drag-and-drop", function(event){
      var file = event.detail.file;
      reader.readAsDataURL(file);
    });

    window.addEventListener("contextmenu", function(event) {
      if (cursor3D.getAttribute('stl-model') != null) {
        var el = document.createElement('a-entity');
        el.setAttribute('stl-model', cursor3D.getAttribute('stl-model'));
        el.setAttribute('scale', cursor3D.getAttribute('scale'));
        var rotation = {x: THREE.Math.radToDeg(cursor3D.object3D.rotation.x), y: THREE.Math.radToDeg(cursor3D.object3D.rotation.y), z: THREE.Math.radToDeg(cursor3D.object3D.rotation.z)};
        var position = cursor3D.getAttribute('position');
        el.setAttribute('position',{x: position.x, y: position.y, z: position.z});
        el.setAttribute('rotation', {x:rotation.x, y:rotation.y, z:rotation.z});
        scene.appendChild(el);
      }
      event.preventDefault();
    });
  </script>
</html>
